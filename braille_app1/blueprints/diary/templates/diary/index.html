<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Diary Entries</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #new-diary {
            font-size: 1.5em;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            cursor: pointer;
            border: 2px solid #28a745;
            background-color: #28a745;
            color: white;
        }
        #new-diary:focus, #new-diary:hover {
            outline: 3px solid blue;
        }
        .entry {
            border: 2px solid #ccc;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .entry:focus, .entry:hover {
            outline: 3px solid blue;
        }
        .entry-title {
            font-size: 1.2em;
            font-weight: bold;
        }
        .buttons {
            margin-top: 10px;
            display: flex;
        }
        .buttons button {
            margin-right: 10px;
            padding: 10px;
            cursor: pointer;
        }
        .buttons button:focus, .buttons button:hover {
            outline: 3px solid blue;
        }
    </style>
</head>
<body>
    <h1>Diary Entries</h1>

    <!-- Add New Entry Button -->
    <button id="new-diary" onclick="addNewDiary()" tabindex="0">New Diary</button>

    <!-- List of Diary Entries -->
    <div id="diary-list">
        {% for entry in entries %}
            <div class="entry" tabindex="0" data-id="{{ entry.id }}">
                <div class="entry-title">{{ entry.entry_date.strftime('%Y-%m-%d %H:%M:%S') }}</div>
                <div class="entry-content">{{ entry.content }}</div>
                <div class="buttons">
                    <button class="action-button write-button" data-action="write" data-id="{{ entry.id }}">Write</button>
                    <button class="action-button read-button" data-action="read" data-id="{{ entry.id }}">Read</button>
                    <button class="action-button delete-button" data-action="delete" data-id="{{ entry.id }}">Delete</button>
                </div>
            </div>
        {% endfor %}
    </div>

    <!-- JavaScript for Mouse and Keyboard Navigation -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const entries = document.querySelectorAll('.entry');
            let currentIndex = -1;
            let currentButtonIndex = -1;

            // Focus on the New Diary button initially
            document.getElementById('new-diary').focus();

            document.addEventListener('keydown', function (event) {
                if (event.key === 'ArrowDown') {
                    if (currentIndex === -1) {
                        currentIndex = 0;
                        entries[currentIndex].focus();
                    } else if (currentIndex < entries.length - 1) {
                        currentIndex++;
                        entries[currentIndex].focus();
                    }
                    currentButtonIndex = -1;
                } else if (event.key === 'ArrowUp') {
                    if (currentIndex > 0) {
                        currentIndex--;
                        entries[currentIndex].focus();
                    } else if (currentIndex === 0) {
                        document.getElementById('new-diary').focus();
                        currentIndex = -1;
                    }
                    currentButtonIndex = -1;
                } else if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {
                    const buttons = currentIndex !== -1 ? entries[currentIndex].querySelectorAll('.action-button') : null;
                    if (buttons && buttons.length > 0) {
                        if (event.key === 'ArrowRight' && currentButtonIndex < buttons.length - 1) {
                            currentButtonIndex++;
                        } else if (event.key === 'ArrowLeft' && currentButtonIndex > 0) {
                            currentButtonIndex--;
                        }
                        if (currentButtonIndex >= 0) {
                            buttons[currentButtonIndex].focus();
                        }
                    }
                } else if (event.key === 'Enter') {
                    if (document.activeElement.id === 'new-diary') {
                        addNewDiary();
                    } else if (document.activeElement.classList.contains('action-button')) {
                        const action = document.activeElement.getAttribute('data-action');
                        const entryId = document.activeElement.getAttribute('data-id');
                        performAction(action, entryId);
                    }
                }
            });

            document.addEventListener('click', function (event) {
                if (event.target.classList.contains('action-button')) {
                    const action = event.target.getAttribute('data-action');
                    const entryId = event.target.getAttribute('data-id');
                    performAction(action, entryId);
                } else if (event.target.id === 'new-diary') {
                    addNewDiary();
                }
            });

            function addNewDiary() {
                window.location.href = '/diary/add';
            }

            function performAction(action, entryId) {
                if (action === 'write') {
                    window.location.href = `/diary/add/${entryId}`;
                } else if (action === 'read') {
                    fetch(`/diary/speak/${entryId}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                        })
                        .catch(error => console.error('Error:', error));
                } else if (action === 'delete') {
                    if (confirm('Are you sure you want to delete this entry?')) {
                        fetch(`/diary/delete/${entryId}`, {
                            method: 'POST'
                        })
                        .then(response => {
                            if (response.ok) {
                                window.location.reload();
                            } else {
                                throw new Error('Error deleting diary entry');
                            }
                        })
                        .catch(error => console.error('Error:', error));
                    }
                }
            }
        });
    </script>
</body>
</html>
